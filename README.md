# Pentest Exam
## Linux escalation of privilege
### SUID exploit via an FTP service

#### Settings of the environment
The environment is composed by two different machines (Docker Container), the first one is the pentester machine (Kali Linux) and the second is the target machine (Ubuntu 18.04) with installed the vsftpd service with the last version (3.0.3).
##### Target machine
- OS: Ubuntu 18.04
- Service installed: cron, vsftpd
- user:
  - root
  - user:user (normal user)
  - pippo:p!pp0 (normal user)
 
Cron:

For this service, a schedule (backup) file is provided in the cron.d folder, containing the settings for 
running the execute.sh file.Execute.sh is an empty executable file that emulates a user-scheduled program. This file is assigned all permission (permission 777).

Vsftpd:

This service is configured by the file /etc/vsftpd.conf. This was modified in this way:
- listen_ipv6=YES
- anonymous_enable=NO
- local_enable=YES
- write_enable=YES
- dirmessage_enable=YES
- use_localtime=YES
- xferlog_enable=YES
- connect_from_port_20=YES
- chown_uploads=YES
- secure_chroot_dir=/var/run/vsftpd/empty
- pam_service_name=vsftpd
- rsa_cert_file=/etc/ssl/certs/ssl-cert-snakeoil.pem
- rsa_private_key_file=/etc/ssl/private/ssl-cert-snakeoil.key

Summarizing this configuration permit to the local users to login into the server with all their permission and navigate without restriction into the file system. Another configuration file modified is hosts.allow where is defined who can access to the system. It was modified adding this entry:
```
Vsftpd: ALL
```

The last file of the service modified is the /etc/init.d/vsftpd where is add only one line (`sleep(1)”`) between the line number 49-50 to fix a bug that rise when the service starts with docker.

To permit the escalation of privilege, was assigned the SUID bit to /usr/bin/find.

##### Pentester Machine
- OS: Kali Linux/ kali-rolling/latest
- Program installed: 
  - Nmap
  - Hydra
  - netcat-traditional
  - Git
  - ftp
- user:
  - root
  
Into the container are copied the git repository [SecLists](https://github.com/danielmiessler/SecLists), used by hydra and execute.sh. This file contains a shell script to establish a reverse shell from the target machine to the pentester machine.

#### How to run the environment

The experiment is based on docker container and to run it, it is only necessary to execute this command: 
```
docker-compose up –d
```
#### Execute the  experiment

To recreate the experiment follow the first part of this [document](/Document/Penetration_Testing_Report_Pietro_Bernabei.pdf)
